<!DOCTYPE html><html lang="zh"><head><link rel="manifest" href="/manifest.json"><meta charset="utf-8"><title>從奧客玩家視角看遊戲防禦性設計 | SSARCandy&#39;s Blog</title><meta name="google-site-verification" content="uUti8Shw9zIz5j2Rs_nwYT9VusmIOXijBuf2bBNYm78"><meta http-equiv="Cache-control" content="public"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#673AB7"><meta name="keywords" content="trashtalk"><meta name="description" content="常常聽到某某遊戲外掛猖獗，作弊仔沒品、破壞遊戲樂趣等等行徑。身為一個好奇寶寶，總是很想知道其中奧秘，雖然我沒有厲害到開發出什麼外掛程式，但這幾年也陸續發現多款遊戲設計上的缺陷，成功用非正當的方式遊玩遊戲 (好含蓄…XD)。看著看著也發現其實這些遊戲的開發者理論上有辦法防止這類型的攻擊，所以只好用我不專業的見解寫下這篇文章。 對沒錯我就是奧客玩家！  本文提及的遊戲只代表曾經可以作弊，不代表現在或未"><meta property="og:type" content="article"><meta property="og:title" content="從奧客玩家視角看遊戲防禦性設計"><meta property="og:url" content="https://ssarcandy.tw/2019/10/02/game-design-from-perspective-of-hacker/index.html"><meta property="og:site_name" content="SSARCandy&#39;s Blog"><meta property="og:description" content="常常聽到某某遊戲外掛猖獗，作弊仔沒品、破壞遊戲樂趣等等行徑。身為一個好奇寶寶，總是很想知道其中奧秘，雖然我沒有厲害到開發出什麼外掛程式，但這幾年也陸續發現多款遊戲設計上的缺陷，成功用非正當的方式遊玩遊戲 (好含蓄…XD)。看著看著也發現其實這些遊戲的開發者理論上有辦法防止這類型的攻擊，所以只好用我不專業的見解寫下這篇文章。 對沒錯我就是奧客玩家！  本文提及的遊戲只代表曾經可以作弊，不代表現在或未"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://ssarcandy.tw/img/2019-10-02/1.jpg"><meta property="og:image" content="https://ssarcandy.tw/img/2019-10-02/2.png"><meta property="og:image" content="https://ssarcandy.tw/img/2019-10-02/3.png"><meta property="article:published_time" content="2019-10-02T15:31:16.000Z"><meta property="article:modified_time" content="2020-01-31T19:21:49.068Z"><meta property="article:author" content="許書軒"><meta property="article:tag" content="trashtalk"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://ssarcandy.tw/img/2019-10-02/1.jpg"><link rel="alternative" href="/atom.xml" title="SSARCandy&#39;s Blog" type="application/atom+xml"><meta name="summary" content="&lt;p&gt;常常聽到某某遊戲外掛猖獗，作弊仔沒品、破壞遊戲樂趣等等行徑。身為一個好奇寶寶，總是很想知道其中奧秘，雖然我沒有厲害到開發出什麼外掛程式，但這幾年也陸續發現多款遊戲設計上的缺陷，成功用非正當的方式遊玩遊戲 (好含蓄…XD)。看著看著也發現其實這些遊戲的開發者理論上有辦法防止這類型的攻擊，所以只好用我不專業的見解寫下這篇文章。&lt;/p&gt;
&lt;p&gt;對沒錯我就是奧客玩家！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本文提及的遊戲只代表曾經可以作弊，不代表現在或未來也可以。&lt;/p&gt;
&lt;/blockquote&gt;"><meta name="Description" content="ssarcandy&#39;s blog. There is always more than one solution."><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><link rel="manifest" href="/web-app-manifest.json"><script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script><meta name="generator" content="Hexo 4.1.1"></head><body><div id="loading" class="active"></div><nav id="menu" class="hide"><div class="inner flex-row-vertical"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off"><i class="icon icon-lg material-icons">close</i></a><div class="brand-wrap"><div class="brand"><a href="/about" class="avatar"><img alt="ssarcandy" src="/img/logo.png"></a><hgroup class="introduce"><h5 class="nickname">許書軒</h5><div class="mail">There is always more than one solution.</div></hgroup></div></div><ul class="nav flex-col"><li class="waves-block waves-effect" style="line-height:44px;height:44px;padding:0 0"><a href="/about"><i class="material-icons icon icon-lg">person</i> <span>About</span></a></li><li class="waves-block waves-effect" style="line-height:44px;height:44px;padding:0 0"><a href="/"><i class="material-icons icon icon-lg">description</i> <span>Posts</span></a></li><li class="waves-block waves-effect" style="line-height:44px;height:44px;padding:0 0"><a href="/archives"><i class="material-icons icon icon-lg">view_list</i> <span>Archives</span></a></li><li class="waves-block waves-effect" style="line-height:44px;height:44px;padding:0 0"><a href="/projects"><i class="material-icons icon icon-lg">code</i> <span>Projects</span></a></li><li class="waves-block waves-effect" style="line-height:44px;height:44px;padding:0 0"><a href="https://github.com/SSARCandy" target="_blank" rel="noopener"><i class="icon icon-lg icon-github"></i> <span>Github</span></a></li></ul><footer class="footer"><p>Total visitors: 45,929</p><p>SSARCandy &copy; 2016 - 2020</p><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a></footer></div></nav><main id="main"><header class="top-header" id="header"><div class="flex-row"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle"><i class="icon icon-lg material-icons">menu</i></a><div class="flex-col header-title ellipsis">從奧客玩家視角看遊戲防禦性設計</div><div class="search-wrap" id="search-wrap"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg material-icons">navigate_before</i> </a><input type="text" id="key" class="search-input" aria-label="search-box" autocomplete="off" placeholder="Keywords"> <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search"><i class="icon icon-lg material-icons">search</i></a></div></div></header><header class="content-header"><div class="container"><h1 class="author">從奧客玩家視角看遊戲防禦性設計</h1><h5 class="subtitle"><time datetime="2019-10-02T15:31:16.000Z" itemprop="datePublished" class="page-time">Oct 02 2019</time></h5></div></header><aside class="post-widget" id="post-widget"><nav class="post-toc-wrap" id="post-toc"><h4>Contents</h4><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Metal-Slug-Attack"><span class="post-toc-text">Metal Slug Attack</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#遊戲王-Duel-Links"><span class="post-toc-text">遊戲王 Duel Links</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Messanger-籃球、足球"><span class="post-toc-text">Messanger 籃球、足球</span></a></li></ol></nav></aside><div class="container body-wrap" id="body-wrap"><article id="post-game-design-from-perspective-of-hacker" class="article article-type-post" itemprop="blogPost"><div class="post-meat flex-row"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trashtalk/" rel="tag">trashtalk</a></li></ul></div><div class="post-meat" style="color:grey;font-size:13px"><i class="icon icon-sm icon-eye" aria-hidden="true"></i> 180</div><div class="post-body"><div class="post-main"><div class="post-content" id="post-content" itemprop="postContent"><p>常常聽到某某遊戲外掛猖獗，作弊仔沒品、破壞遊戲樂趣等等行徑。身為一個好奇寶寶，總是很想知道其中奧秘，雖然我沒有厲害到開發出什麼外掛程式，但這幾年也陸續發現多款遊戲設計上的缺陷，成功用非正當的方式遊玩遊戲 (好含蓄…XD)。看著看著也發現其實這些遊戲的開發者理論上有辦法防止這類型的攻擊，所以只好用我不專業的見解寫下這篇文章。</p><p>對沒錯我就是奧客玩家！</p><blockquote><p>本文提及的遊戲只代表曾經可以作弊，不代表現在或未來也可以。</p></blockquote><a id="more"></a><p>說到這幾年陸續看到隙可趁的遊戲，方法不外乎是兩個，一是藉由封包攔截查看內容再藉由修改封包資訊重送來攻擊，二是直接更改記憶體位置的值，這兩個方法都是非常直接暴力，案例很多，容我一一介紹。</p><h1 id="Metal-Slug-Attack"><a href="#Metal-Slug-Attack" class="headerlink" title="Metal Slug Attack"></a>Metal Slug Attack</h1><div><img src="/img/2019-10-02/1.jpg" alt="這遊戲是我的啟蒙導師，他教會我好多網路傳輸知識。金幣 99999999+ 是基本" data-action="zoom"><span class="image-caption">這遊戲是我的啟蒙導師，他教會我好多網路傳輸知識。金幣 99999999+ 是基本</span></div><p>其實這遊戲我已經寫過一篇文章了，但容我再次鞭屍 🤣</p><p>這遊戲是十分經典只要會察看網路封包，一定有辦法使用重送攻擊。到底什麼是查看封包再重送呢？來看看他的遊戲模式：基本上是關卡制塔防遊戲，勝利可以拿到獎勵。所以當我攔截到<strong>開始</strong>跟<strong>結束</strong>的封包訊息之後，我就可以直接自動刷關了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Start event level=HELL......<span class="variable">$i</span>"</span></span><br><span class="line">send_request \</span><br><span class="line">    <span class="string">"cover=1&amp;deck_no=12&amp;stage_id=<span class="variable">$stage_id</span>&amp;unit_ids[]=604&amp;unit_ids[]=485&amp;unit_level[]=50&amp;unit_level[]=50"</span> \</span><br><span class="line">    <span class="string">"https://msattack.snkplaymore.info/event/marathon2nd/battle_start/?kpi1=<span class="variable">$stage_id</span>"</span>  &gt; /dev/null</span><br><span class="line"></span><br><span class="line">send_request \</span><br><span class="line">    <span class="string">"stage_id=<span class="variable">$stage_id</span>&amp;battle_time=25&amp;drop_num=<span class="variable">$drop_num</span>"</span> \</span><br><span class="line">    <span class="string">"https://msattack.snkplaymore.info/event/marathon2nd/battle_win/"</span> &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Win event level=HELL........<span class="variable">$i</span>"</span></span><br></pre></td></tr></table></figure><p>可以看到所有的參數都是透過明文傳輸，唯一的保護是有使用 https，但這樣並無法防止封包被查看，因為只要建立 Proxy server 並自己簽署一個 SSL 憑證，還是可以偷看 https 的封包。<br>那如果我是開發者我會怎麼改善呢？比較基本的是加上 <code>nonce</code> 在 request 裡面並加密參數。<br><code>nonce</code> 本身是一個遞增數字，伺服器端須檢查 <code>nonce</code> 值要是遞增的不然就非合法。這種作法常見於加密貨幣交易所的 API 設計，這也是防止重送攻擊常見的手段。<sup>[1]</sup></p><h1 id="遊戲王-Duel-Links"><a href="#遊戲王-Duel-Links" class="headerlink" title="遊戲王 Duel Links"></a>遊戲王 Duel Links</h1><p>曾經風靡一陣子的遊戲王卡牌遊戲，同時也是伺服器設計有嚴重缺陷，嚴重到我覺得他們工程師可以東西收一收的程度。<br>這遊戲我開服三天就把全腳色練到滿等，同時集齊當時所有 UR SR 卡片，兩個禮拜後覺得太無聊直接棄坑，堪稱我玩過時間最短的遊戲。</p><div><img src="/img/2019-10-02/2.png" alt="Blue Eyes White Dragon!! 我有一打!!" data-action="zoom"><span class="image-caption">Blue Eyes White Dragon!! 我有一打!!</span></div><p>其實他們犯了常見的錯誤，就是所謂 Atomic 操作原則。<br>有些事情是必須一起完成的，否則就應當全部都不算數。比如說：「我用十元買了一枝筆」，那我的錢包應該要減少十元，並且增加一枝筆。這其中每個動作缺一不可：如果錢包沒扣錢，則整段交易應該都要失敗並回復到原本的狀態。這很基本很合理。<br>此遊戲一樣是遊玩扣體力的機制，藉由有限體力來使一般人無法狂練等。但查看封包後發現，他開始關卡跟扣體力是兩個不同的 API，是透過遊戲先發送<strong>開始</strong>再發送<strong>扣體力</strong>的訊息，這樣一來我只要一直狂重送開始但不送扣體力，我就可以無限遊玩刷等。真的太扯了…..</p><p>另外在設計 server side service 時，有一個大原則就是不可以相信客戶端送來的資料，永遠必須做驗證。</p><p>而且客戶端不該發送結果，應該只發送欲執行的操作。用剛剛的例子來說：<br>「我用十元買了一枝筆，我的錢包減少十元，並且增加一枝筆。」→ 由客戶端計算結果是不可以的。<br>「我要用十元買一枝筆。」→ 只發送欲執行的操作，實際結果應由伺服器端執行，才能確保合法性。</p><p>唉，本遊戲真的是奇觀。</p><h1 id="Messanger-籃球、足球"><a href="#Messanger-籃球、足球" class="headerlink" title="Messanger 籃球、足球"></a>Messanger 籃球、足球</h1><p>Messanger 兩年前推出可以在聊天室內玩籃球的彩蛋，浪費了我無數個小時在那邊投籃，其實也是有辦法作弊的。<br>前面提到我目前知道的方法不外乎是藉由封包攔截重送來攻擊或是直接更改記憶體位置的值，facebook 在中間人攻擊下了不少工夫，至少就我的觀察只要使用任何 Proxy server 似乎都會無法正常使用 Messanger，所以封包攔截重送這條路就很難走了。</p><p>剩下試試直接更改記憶體位置吧，基本上原理就是掃過全部此應用程式用到的記憶體位置並尋找指定的數值。比如說投籃好了，投進 1 分時先尋找記憶體中數值等於 1 的，再投進一次就進一步搜尋數值等於 2 的記憶體位置，以此類推直到精確地找到代表分數的記憶體位置，再修改其值。</p><div><img src="/img/2019-10-02/3.png" alt="找到對的記憶體位置，成為灌籃高手不成問題！" data-action="zoom"><span class="image-caption">找到對的記憶體位置，成為灌籃高手不成問題！</span></div><p>很遺憾的是如果遊戲是單機遊戲，基本上是不可能防止記憶體竄改的<sup>[2]</sup>，只能讓他變更難修改沒辦法完全防止。比較常見的做法是增加一個 dirty check 的檢查值，比如說分數的平方。在這樣的設計下，當你的分數被竄改成 \(X\) 時，你的檢查值如果不是 \(X^2\) ，那就代表本次分數不合法。但說實在的這種方式防君子不防小人，真的有耐心的還是找得出檢查值並加以修改…。</p><hr><p>不過其實這類的防禦性設計有時候根本不見得需要，以我上述提到的例子而言，除了遊戲王缺陷太嚴重以外，其實其他的都不見得需要做改善。像是 Metal Slug Attack 無法做到數據的篡改，能做到的只有自動花體力刷關；而 Messanger 的遊戲根本是類單機遊戲，就算拿高分也只是自爽。</p><p>所以到頭來，最有趣的還是尋找系統缺失的過程吧…😅</p><p>References:</p><p>[1] <a href="https://en.wikipedia.org/wiki/Cryptographic_nonce" target="_blank" rel="noopener">Cryptographic nonce</a><br>[2] <a href="https://gamedev.stackexchange.com/questions/48629/how-do-i-prevent-memory-modification-cheats" target="_blank" rel="noopener">How do I prevent memory-modification cheats?</a></p></div><nav class="post-nav"><div class="waves-block waves-effect prev fl"><a href="/2020/01/29/timing-attack/" id="post-prev" class="post-nav-link"><div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div><h4 class="title">Timing Attack in String Compare</h4></a></div><div class="waves-block waves-effect next fr"><a href="/2019/08/12/Ways-to-Access-Internal-Network/" id="post-next" class="post-nav-link"><div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div><h4 class="title">Ways to Access Internal Network</h4></a></div></nav><section id="comments"><div id="disqus_thread"></div><script>!function(){var t=document,e=t.createElement("script");e.src="https://ssarcandy.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript></section></div></div></article><script src="/js/zoom.js"></script><script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": "https://ssarcandy.tw/2019/10/02/game-design-from-perspective-of-hacker/",
  "headline": "從奧客玩家視角看遊戲防禦性設計",
  "datePublished": "1570030276000",
  "dateModified": "1570030276000",
  "author": "SSARCandy",
  "image": {
    "@type": "ImageObject",
    "url": "https://ssarcandy.tw"
  },
  "publisher":{ 
    "@type" : "Organization",
    "name": "SSARCandy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ssarcandy.tw/img/logo.png"
    }
  }     
}</script></div></main><div class="mask" id="mask"></div><a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light" aria-label="go to top"><span class="icon icon-lg icon-chevron-up"></span></a><script src="https://cdnjs.cloudflare.com/ajax/libs/node-waves/0.7.6/waves.min.js"></script><script src="/js/main.js"></script><div class="search-panel" id="search-panel"><ul class="search-result" id="search-result"></ul></div><script type="text/template" id="search-tpl"><li class="item">
    <a href="/{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li></script><script src="/js/search.js"></script><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-81178870-1","auto"),ga("send","pageview")</script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js?t=1580498591838").then(function(){console.log("ServiceWorker Register Successfully.")}).catch(function(e){console.error(e)})</script><script type="text/x-mathjax-config">MathJax.Hub.Config("");</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>